<div class="design-container">
    <div class="design-title-container">
        <div class="design-title-text">Hephillu3d</div>
        
    </div>
    <div class="design-content-container">
        <div class="design-content-column-container">
            <div class="design-content-column-title">
                Upload & Preview
            </div>
            <div class="design-content-column-subtitle">
                Choose how you'd like to start:
            </div>
            <div class="design-content-column-radio-button-list-item">
                <input
                    type="radio"
                    id="model-option-radio-button"
                    name="upload-option"
                    class="radio"
                    onclick="showHidePromptInput()"
                />
                <label for="upload-options" class="design-content-column-radio-button-label">Upload Your 3D Model</label>                
            </div>              
            <div class="design-content-column-radio-button-sublabel">
                (.obj, .stl, .ply, etc.)
            </div>      
            <div class="design-content-column-radio-button-list-item">
                <input
                    type="radio"
                    id="text-option-radio-button"
                    name="upload-option"
                    class="radio"
                    onclick="showHidePromptInput()"
                />
                <label for="upload-options" class="design-content-column-radio-button-label">Or type a description and let our AI create your model!</label>                
            </div> 
            <div class="design-content-column-uploader" id="file-uploader" style="display: none">
                <input
                    type="file"
                    id="image-input"
                    name="image-input"
                    accept="image/png, image/jpeg"
                    class="button"
                    style="display:none;"
                    onchange="updateFileSelectButtonLabel()"
                />
                <label for="image-input" class="file-select-button" id="file-select-button-label">Select File</label>
                <input
                    type="submit"
                    class="button"
                    value="Upload"
                    id="upload-button"
                    style="display:none;"
                    onclick="uploadFile()"
                />                    
                <label for="upload-button" class="upload-button" id="upload-button-label">Upload</label>
                <div class="upload-loader" style="display: none" id="upload-loader"><img id="loader-gif" width=15 height=15 src="images/loading.gif"/><span id="image-progress"> processing 0%</span></div>
            </div>           
            <div class="design-content-column-textarea" id="prompt-input" style="display: none">
                <textarea type="text"></textarea>
            </div>
            <div class="design-content-column-button">
                <button>
                    Continue
                </button>
            </div>
        </div>
        <div class="design-content-column-container">
            <div class="design-content-column-title">
                Design Your Glow
            </div>
            <div class="design-content-column-subtitle">
                Size:
            </div>
            <div class="design-content-column-radio-button-list-item">
                <input
                    type="radio"
                    id="small-option-radio-button"
                    name="glow-option"
                    class="radio"
                />
                <label for="glow-options" class="design-content-column-radio-button-label">Small</label>                
            </div>         
            <div class="design-content-column-radio-button-list-item">
                <input
                    type="radio"
                    id="medium-option-radio-button"
                    name="glow-option"
                    class="radio"
                />
                <label for="glow-options" class="design-content-column-radio-button-label">Medium</label>                
            </div><div class="design-content-column-radio-button-list-item">
                <input
                    type="radio"
                    id="larg-option-radio-button"
                    name="glow-option"
                    class="radio"
                />
                <label for="glow-options" class="design-content-column-radio-button-label">Large</label>                
            </div>
            <hr/>
            <div class="design-content-column-radio-button-list-item">
                <input
                    type="checkbox"
                    id="larg-option-radio-button"
                    name="candle-option"
                    class="checkbox"
                />
                <label for="candle-options" class="design-content-column-radio-button-label">LED Candle</label>                
            </div>
            <div class="design-content-column-radio-button-sublabel">
                Add an LED tea light candle inside
            </div>
            <div class="design-content-column-button">
                <button>
                    Add to Cart
                </button>
            </div>
        </div>
        <div class="design-content-column-container">
            <div class="design-content-column-title">
                Checkout
            </div>
            <div class="design-content-column-invoice-container">
                <!-- template -->
                <div class="design-content-column-invoice-preview-container">
                    <div class="design-content-column-invoice-preview-column">
                        <img height=100 src="images/home.png" />
                    </div>
                    <div class="design-content-column-invoice-preview-column">
                        <div class="design-content-column-invoice-preview-column-title">
                            Pumpkin Cat
                        </div>
                        <div class="design-content-column-invoice-preview-column-subtitle">
                            Size, Medium
                        </div>
                        <div class="design-content-column-invoice-preview-column-candle-type">
                            LED Candle
                        </div>
                    </div>
                </div>
                <hr/>
                <div class="design-content-column-invoice-amount-container">
                    <div class="design-content-column-invoice-amount-line-item">
                        <div class="design-content-column-invoice-amount-line-item-title">
                            Subtotal
                        </div>
                        <div class="design-content-column-invoice-amount-line-item-amount">
                            $25.00
                        </div>
                    </div>
                    <div class="design-content-column-invoice-amount-line-item">
                        <div class="design-content-column-invoice-amount-line-item-title">
                            Shipping
                        </div>
                        <div class="design-content-column-invoice-amount-line-item-amount">
                            $4.99
                        </div>
                    </div>
                    <hr/>
                    <div class="design-content-column-invoice-amount-line-item">
                        <div class="design-content-column-invoice-amount-line-item-title">
                            Total
                        </div>
                        <div class="design-content-column-invoice-amount-line-item-amount">
                            $29.99
                        </div>
                    </div>
                </div>
                <!-- end template -->
            </div>            
            <div class="design-content-column-button">
                <button>
                    Proceed to Payment
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    const showHidePromptInput = function() {
        const radioButton = document.getElementById("text-option-radio-button");
        const promptInput = document.getElementById("prompt-input");
        const fileUploader = document.getElementById("file-uploader");
        if (radioButton.checked) {
            promptInput.style.display = "unset";
            fileUploader.style.display = "none";
        } else {
            promptInput.style.display = "none";
            fileUploader.style.display = "unset";
        }
    }
    const updateFileSelectButtonLabel = function() {
        const label = document.getElementById('file-select-button-label');
        const imageInput = document.getElementById("image-input")
        label.innerHTML = imageInput.files[0].name;
    }
    const uploadFile = async function() {       
        
        const imageInput = document.getElementById("image-input")
        const file = imageInput.files[0];
        imageInput.disabled = true;
        const uploadButtonLabel = document.getElementById('upload-button-label');
        uploadButtonLabel.style.display = "none";
        const uploadLoader = document.getElementById("upload-loader");
        uploadLoader.style.display = "unset";
        
        document.getElementById("text-option-radio-button").disabled = true;

        var data = new FormData()
        data.append('file', imageInput.files[0])

        var taskId = "";
        var res = await fetch("/api/image", { body: data, method: "POST" });
        var json = {}
        if (res.ok) {
            json = await res.json();
            taskId = json.taskId;
        }

        var progress = 0;
        var thumbnailUrl = "";
        while (progress < 100) {
            await new Promise(resolve => setTimeout(resolve, 5000));
            res = await fetch("/api/image/?taskId=" + taskId);
            if (res.ok) {
                json = await res.json();
                progress = json.progress;
                const imageProgress = document.getElementById("image-progress");
                imageProgress.innerHTML = ` processing ${progress}%`;
                if (progress === 100) {
                    thumbnailUrl = json.thumbnailUrl;
                    const loaderGif = document.getElementById("loader-gif");
                    loaderGif.style.display = 'none'
                }
            }         
        }
    }
</script>